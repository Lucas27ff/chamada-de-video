<!-- substitua seu cÃ³digo anterior por este -->
<video id="mainVideo" class="full-video" autoplay playsinline muted>
  <source src="https://Lucas27ff.github.io/chamada-de-video/veri.mp4" type="video/mp4" />
</video>

<audio id="callAudio">
  <source src="https://Lucas27ff.github.io/chamada-de-video/veri.mp3" type="audio/mpeg" />
</audio>

<div id="endCallMessage" class="end-call-msg">ðŸ”´ Chamada encerrada</div>

<style>
  .end-call-msg {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    background: rgba(0,0,0,0.85);
    padding: 30px 40px;
    border-radius: 15px;
    color: white;
    font-size: 22px;
    z-index: 999;
    text-align: center;
    display: none;
    box-shadow: 0 0 20px rgba(255,255,255,0.1);
  }
</style>

<script>
  const videoUser = document.getElementById('userCam');
  const callTimeElem = document.getElementById('callTime');
  const callAudio = document.getElementById('callAudio');
  const mainVideo = document.getElementById('mainVideo');
  const endCallMessage = document.getElementById('endCallMessage');
  const endButton = document.querySelector('.end-call');

  let seconds = 0;
  let timerInterval;
  let stream;

  async function startCamera() {
    try {
      stream = await navigator.mediaDevices.getUserMedia({ video: true, audio: false });
      videoUser.srcObject = stream;
    } catch (err) {
      alert('Erro ao acessar a cÃ¢mera: ' + err.message);
    }
  }

  function updateCallTime() {
    seconds++;
    const m = String(Math.floor(seconds / 60)).padStart(2, '0');
    const s = String(seconds % 60).padStart(2, '0');
    callTimeElem.textContent = `${m}:${s}`;
  }

  function startTimer() {
    timerInterval = setInterval(updateCallTime, 1000);
  }

  function stopCall() {
    clearInterval(timerInterval);
    callAudio.pause();
    callAudio.currentTime = 0;

    if (stream) {
      stream.getTracks().forEach(track => track.stop());
    }

    if (endButton) {
      endButton.style.display = 'none';
    }

    endCallMessage.style.display = 'block';
  }

  mainVideo.onplay = () => {
    callAudio.play().catch(() => {});
    startTimer();
  };

  mainVideo.onended = stopCall;

  startCamera();
</script>
