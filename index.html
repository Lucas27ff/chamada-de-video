async function endCall() {
  if (callEnded) return; // evita múltiplas chamadas
  callEnded = true;

  localStorage.setItem('callEnded', 'true');

  mainVideo.pause();
  callAudio.pause();
  mainVideo.loop = false;

  if (videoUser.srcObject) {
    videoUser.srcObject.getTracks().forEach(track => track.stop());
  }

  // Mostra mensagem com classe para animação
  callEndedMessage.textContent = "A chamada foi encerrada.\nObrigado por usar nosso serviço!";
  callEndedMessage.classList.add('show');

  clearInterval(callInterval);

  try {
    await endCallAudio.play();
  } catch (e) {
    console.warn('Não foi possível reproduzir o áudio de encerramento:', e);
  }

  mainVideo.style.display = 'none';
  videoUser.style.display = 'none';
  endCallButton.style.display = 'none';
  document.querySelector('.user-info').style.display = 'none';
  callTimeElem.textContent = '00:00';
}
